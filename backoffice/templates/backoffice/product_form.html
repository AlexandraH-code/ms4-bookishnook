{% extends "backoffice/base_backoffice.html" %}
{% load crispy_forms_tags %}
{% block backoffice_content %}
<h2 class="mb-3">{{ title }}</h2>
<form method="post" enctype="multipart/form-data" class="card p-3">
  {% csrf_token %}
  {{ form|crispy }}
  <div class="d-flex">
    <button class="btn bn-btn-primary mr-2">Save</button>
    <a class="btn btn-outline-secondary" href="{% url 'backoffice:products_list' %}">Cancel</a>
  </div>
</form>
<script>
(function(){
  function slugify(str){
    return (str || "")
      .toString().normalize("NFD").replace(/[\u0300-\u036f]/g,"")
      .toLowerCase()
      .replace(/[^a-z0-9]+/g,"-")
      .replace(/^-+|-+$/g,"")
      .substring(0,80);
  }
  document.addEventListener('DOMContentLoaded', function(){
    var name = document.getElementById('id_name');
    var slug = document.getElementById('id_slug');
    if (!name || !slug) return;
    // Only autofill slug if it is empty or matches previous auto
    var touched = false;
    slug.addEventListener('input', function(){ touched = true; });
    name.addEventListener('input', function(){
      if (!touched || !slug.value) slug.value = slugify(name.value);
    });
  });
})();
</script>

{% endblock %}
