{% extends "base.html" %}
{% load static price_filters %}

{% block title %}{{ product.name }} â€“ Bookish Nook{% endblock %}

{% block extra_head %}
  {% if product.image %}
    <link rel="preload" as="image" href="{{ product.image.url }}">
  {% endif %}
{% endblock %}

{% block content %}
<div class="row">
  <div class="col-md-6 mb-3">
    {% if product.image %}
      <img src="{{ product.image.url }}" class="img-fluid rounded product-hero-img" alt="{{ product.name }}"
           loading="eager" width="1200" height="1200">
    {% else %}
      <img src="{% static 'images/placeholder.jpg' %}" class="img-fluid rounded product-hero-img" alt="{{ product.name }}"
           loading="eager" width="1200" height="1200">
    {% endif %}
  </div>
  <div class="col-md-6">
    <h1 class="product-title bn-section-title mb-3">{{ product.name }}</h1>
    <div class="text-muted mb-2">{{ product.category.name }}</div>
    <div class="h4 mb-3">{{ product.price|currency }}</div>
    <p>{{ product.description|linebreaks }}</p>
    <form action="{% url 'cart:add' product.id %}" method="post" class="mt-3">
      {% csrf_token %}
      <div class="form-inline">
        <label for="qty-detail" class="sr-only">Quantity</label>
        <input id="qty-detail" type="number" name="qty" value="1" min="1" max="{{ product.stock }}"
               class="form-control mr-2" style="width:100px" aria-label="Quantity">
        <button class="btn bn-btn-primary" {% if product.stock == 0 %}disabled{% endif %}>
          {% if product.stock == 0 %}Out of stock{% else %}Add to cart{% endif %}
        </button>
      </div>
    </form>
  </div>
</div>

{% if related %}
<hr class="my-4">
<h2 class="mb-3">You may also like</h2>
<div class="row">
  {% for p in related %}
  <div class="col-md-3 col-6 mb-4">
    <a href="{{ p.get_absolute_url }}" class="bn-card d-block text-center">
      {% if p.image %}
        <img src="{{ p.image.url }}" class="img-fluid bn-card-img" alt="{{ p.name }}" loading="lazy" width="400" height="400">
      {% else %}
        <img src="{% static 'images/placeholder.jpg' %}" class="img-fluid bn-card-img" alt="{{ p.name }}" loading="lazy" width="400" height="400">
      {% endif %}
      <h6 class="mt-2">{{ p.name }}</h6>
      <div class="text-muted">{{ p.price }} SEK</div>
    </a>
  </div>
  {% endfor %}
</div>
{% endif %}
{% endblock %}
