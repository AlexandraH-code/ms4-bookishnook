{% extends "base.html" %}
{% load static price_filters %}

{% block title %}Products – Bookish Nook{% endblock %}

{% block content %}
{# --- Rubrik på egen rad --- #}
<div class="row">
  <div class="col-12">
    <h1 class="bn-section-title mb-3">
      {% if category %}{{ category.name }}{% else %}All Products{% endif %}
    </h1>
  </div>
</div>

{# --- Sök / Sort på nästa rad (stackad på mobil, i rad på md+) --- #}
<div class="row align-items-center mb-3">
  <div class="col-12 col-md-6 mb-2 mb-md-0">
    <form class="w-100" method="get">
      <div class="input-group">
        <input class="form-control" type="text" name="q" placeholder="Search..." value="{{ q|default:'' }}">
        <div class="input-group-append">
          <button class="btn bn-btn-primary" type="submit">Search</button>
        </div>
      </div>
    </form>
  </div>

  <div class="col-12 col-md-6 d-flex justify-content-md-end">
    <form class="form-inline w-100 w-md-auto" method="get">
      {# bevara söksträngen när man sorterar #}
      {% if q %}<input type="hidden" name="q" value="{{ q }}">{% endif %}
      <label for="sort" class="mr-2 mb-2 mb-md-0">Sort:</label>
      <select id="sort" name="sort" class="form-control mr-2 mb-2 mb-md-0">
        <option value="name"     {% if sort == "name" %}selected{% endif %}>Name A–Z</option>
        <option value="-name"    {% if sort == "-name" %}selected{% endif %}>Name Z–A</option>
        <option value="price"    {% if sort == "price" %}selected{% endif %}>Price Low→High</option>
        <option value="-price"   {% if sort == "-price" %}selected{% endif %}>Price High→Low</option>
        <option value="-created" {% if sort == "-created" %}selected{% endif %}>Newest</option>
        <option value="created"  {% if sort == "created" %}selected{% endif %}>Oldest</option>
      </select>
      <button class="btn btn-outline-secondary mb-2 mb-md-0" type="submit">Apply</button>
    </form>
  </div>
</div>

{# --- Kategori-knappar (wrap + luft) --- #}
<div class="bn-chipwrap mb-3">
  <a href="{% url 'products:list' %}" class="btn bn-chip mb-2">All</a>
  {% for c in categories %}
    <a href="{{ c.get_absolute_url }}" class="btn bn-chip mb-2">{{ c.name }}</a>
  {% endfor %}
</div>

<div class="row">
  {% for p in products %}
  <div class="col-md-3 col-6 mb-4">
    <div class="bn-card text-center">
      {% if p.image %}
        <img src="{{ p.image.url }}" class="img-fluid bn-card-img" alt="{{ p.name }}">
      {% else %}
        <img src="{% static 'images/placeholder.jpg' %}" class="img-fluid bn-card-img" alt="{{ p.name }}">
      {% endif %}
      <h5 class="mt-2">{{ p.name }}</h5>
      <div class="text-muted mb-2">{{ p.category.name }}</div>
      <div class="font-weight-bold mb-2">{{ p.price|currency }}</div>
      <a href="{{ p.get_absolute_url }}" class="btn bn-btn-primary btn-sm">View</a>
    </div>
  </div>
  {% empty %}
  <div class="col-12 text-center py-5">No products found.</div>
  {% endfor %}
</div>
{% endblock %}
