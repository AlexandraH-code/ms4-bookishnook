<!-- Social banner -->
<div class="bg-dark text-light text-center py-1 small">
  <a href="https://www.instagram.com/" class="text-light mx-2" target="_blank" rel="noopener" aria-label="Link to Instagram (opens in new tab)">
    <i class="fab fa-instagram"></i> Instagram
  </a>
  <a href="https://www.facebook.com/" class="text-light mx-2" target="_blank" rel="noopener" aria-label="Link to Facebook (opens in new tab)">
    <i class="fab fa-facebook"></i> Facebook
  </a>
</div>

<!-- ÖVRE RAD: Sök vänster, brand centrerad, varukorg höger -->
<nav class="navbar navbar-light bg-light border-bottom py-2">
  <div class="container navbar-grid">

    <!-- Vänster: mobil-ikon + desktop-sök -->
    <div class="d-flex align-items-center">
      <!-- Mobil och tablet: togglar fällbart sökfält -->
      <button class="btn btn-link d-lg-none text-dark pr-2" type="button"
              data-toggle="collapse" data-target="#mobileSearch"
              aria-controls="mobileSearch" aria-expanded="false" aria-label="Toggle search">
        <i class="fas fa-search"></i>
      </button>

      <!-- Desktop: synligt sökfält -->
      <form action="{% url 'products:list' %}" method="get" class="form-inline d-none d-lg-flex">
        <input class="form-control mr-2" 
          type="search"
          name="q" 
          placeholder="Search products..." 
          aria-label="Search"
          value="{{ request.GET.q|default:'' }}">
        <button class="btn btn-outline-success" type="submit">
          <i class="fas fa-search"></i>
        </button>
      </form>
    </div>

    <!-- Mitten: Brand (ingen absolute, ingen w-100) -->
    <a class="navbar-brand bn-title text-center mx-0" href="/">Bookish Nook</a>

    <!-- Höger: Varukorg -->
    <div class="d-flex align-items-center justify-content-end">
      {% if request.user.is_authenticated %}
        <a href="{% url 'profiles:dashboard' %}" class="text-dark mr-3" title="My Account">
          <i class="far fa-user"></i>
        </a>
        <a href="{% url 'account_logout' %}" class="text-dark mr-3">Logout</a>
      {% else %}
        <a href="{% url 'account_login' %}" class="text-dark mr-3">Sign in</a>
        <a href="{% url 'account_signup' %}" class="text-dark mr-3">Create account</a>
      {% endif %}
      <a href="{% url 'cart:view' %}" class="text-dark position-relative" title="Cart">
        <i class="fas fa-shopping-cart"></i>
        <span class="badge badge-pill badge-danger position-absolute" style="top:-8px; right:-10px;">
          {{ cart_count|default:0 }}
        </span>
      </a>
    </div>
  </div>
</nav>

<!-- Fällbart sökfält på mobil -->
<div class="collapse bg-light border-bottom d-lg-none" id="mobileSearch">
  <form action="{% url 'products:list' %}" method="get" class="p-2">
    <div class="input-group">
      <input class="form-control" 
        type="search" 
        name="q"
        placeholder="Search products..." 
        aria-label="Search"
        value="{{ request.GET.q|default:'' }}">
      <div class="input-group-append">
        <button class="btn btn-outline-success" type="submit">
          <i class="fas fa-search"></i>
        </button>
      </div>
    </div>
  </form>
</div>

<!-- NEDRE RAD: Huvudmeny + dropdowns. My Account längst ner på mobil -->
<nav class="navbar navbar-expand-lg navbar-dark bn-brown">
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#mainNav"
          aria-controls="mainNav" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse justify-content-center" id="mainNav">
  <ul class="navbar-nav bn-navbar">
  {% for root in root_categories %}
    {% if bookmarks_cat and root.id == bookmarks_cat.id %}
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle"
           href="{{ bookmarks_cat.get_absolute_url }}"
           id="navBookmarks"
           data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          {{ bookmarks_cat.name }}
        </a>
        <div class="dropdown-menu bn-dropdown" aria-labelledby="navBookmarks">
          {% for child in bookmarks_cat.children.all %}
            <a class="dropdown-item" href="{{ child.get_absolute_url }}">{{ child.name }}</a>
          {% empty %}
            <span class="dropdown-item text-muted">No subcategories</span>
          {% endfor %}
          <div class="dropdown-divider"></div>
          <a class="dropdown-item font-weight-bold" href="{{ bookmarks_cat.get_absolute_url }}">All Bookmarks</a>
        </div>
      </li>
    {% else %}
      <li class="nav-item">
        <a class="nav-link" href="{{ root.get_absolute_url }}">{{ root.name }}</a>
      </li>
    {% endif %}
  {% endfor %}
  </ul>

    <!-- My Account längst ned i menyn på mobil (syns bara i collapse) -->
    <ul class="navbar-nav d-lg-none w-100 mt-2 pt-2 border-top">
      <li class="nav-item">
        <a class="nav-link d-flex align-items-center" href="{% url 'profiles:dashboard' %}" title="My Account">
          <i class="far fa-user mr-2"></i> My Account
        </a>
      </li>
    </ul>
  </div>
</nav>